{% extends "base.html" %}

{% block title %}GESTIMA - Dashboard{% endblock %}

{% block head %}
<!-- Layout overrides jsou nyn√≠ v base.html -->
{% endblock %}

{% block content %}
<div>
    <h1 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 1.5rem; text-align: center;">Dashboard</h1>

    <!-- Dla≈ædicov√° navigace - flexbox s wrap -->
    <div style="display: flex; flex-wrap: wrap; gap: 1rem; justify-content: center;">

        <!-- Funkƒçn√≠: D√≠ly -->
        <a href="/parts" class="dashboard-tile" style="
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: var(--bg-secondary); border: 2px solid var(--accent-blue);
            border-radius: 12px; padding: 1.5rem; text-decoration: none;
            transition: all 0.2s; min-height: 120px; width: 180px;
        " onmouseover="this.style.background='var(--accent-blue)'; this.style.transform='translateY(-2px)';"
           onmouseout="this.style.background='var(--bg-secondary)'; this.style.transform='none';">
            <span style="font-size: 2.5rem; margin-bottom: 0.5rem;">üìã</span>
            <span style="color: var(--text-primary); font-weight: 600; font-size: 1rem;">D√≠ly</span>
            <span style="color: var(--text-muted); font-size: 0.75rem;">Seznam v≈°ech d√≠l≈Ø</span>
        </a>

        <!-- Funkƒçn√≠: Nov√Ω d√≠l -->
        <a href="/parts/new" class="dashboard-tile" style="
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: var(--bg-secondary); border: 2px solid var(--accent-green);
            border-radius: 12px; padding: 1.5rem; text-decoration: none;
            transition: all 0.2s; min-height: 120px; width: 180px;
        " onmouseover="this.style.background='var(--accent-green)'; this.style.transform='translateY(-2px)';"
           onmouseout="this.style.background='var(--bg-secondary)'; this.style.transform='none';">
            <span style="font-size: 2.5rem; margin-bottom: 0.5rem;">‚ûï</span>
            <span style="color: var(--text-primary); font-weight: 600; font-size: 1rem;">Nov√Ω d√≠l</span>
            <span style="color: var(--text-muted); font-size: 0.75rem;">Vytvo≈ôit nov√Ω</span>
        </a>

        <!-- Funkƒçn√≠: Rychl√Ω skok s dynamick√Ωm filtrem -->
        <div x-data="quickJump()" class="dashboard-tile" style="
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: var(--bg-secondary); border: 2px solid var(--accent-orange);
            border-radius: 12px; padding: 1.5rem; min-height: 120px; width: 180px;
        ">
            <span style="font-size: 2rem; margin-bottom: 0.5rem;">üöÄ</span>
            <span style="color: var(--text-primary); font-weight: 600; font-size: 0.9rem; margin-bottom: 0.5rem;">Rychl√Ω skok</span>
            <input
                type="text"
                x-model="search"
                @keydown.enter="jumpToPart()"
                :disabled="loading"
                placeholder="ID / ƒç√≠slo / article"
                style="
                    width: 140px; padding: 0.4rem 0.5rem; text-align: center;
                    background: var(--bg-primary); border: 1px solid var(--border-color);
                    border-radius: 6px; color: var(--text-primary); font-size: 0.85rem;
                "
            >
            <span x-show="loading" style="color: var(--text-muted); font-size: 0.7rem; margin-top: 0.3rem;">Hled√°m...</span>
        </div>

        <!-- Nefunkƒçn√≠: Materi√°ly -->
        <div class="dashboard-tile" style="
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: var(--bg-secondary); border: 2px solid var(--border-color);
            border-radius: 12px; padding: 1.5rem; min-height: 120px; width: 180px; opacity: 0.5;
        ">
            <span style="font-size: 2.5rem; margin-bottom: 0.5rem;">üß±</span>
            <span style="color: var(--text-secondary); font-weight: 600; font-size: 1rem;">Materi√°ly</span>
            <span style="color: var(--text-muted); font-size: 0.7rem; font-style: italic;">P≈ôipravujeme</span>
        </div>

        <!-- Nefunkƒçn√≠: Operace -->
        <div class="dashboard-tile" style="
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: var(--bg-secondary); border: 2px solid var(--border-color);
            border-radius: 12px; padding: 1.5rem; min-height: 120px; width: 180px; opacity: 0.5;
        ">
            <span style="font-size: 2.5rem; margin-bottom: 0.5rem;">‚öôÔ∏è</span>
            <span style="color: var(--text-secondary); font-weight: 600; font-size: 1rem;">Operace</span>
            <span style="color: var(--text-muted); font-size: 0.7rem; font-style: italic;">P≈ôipravujeme</span>
        </div>

        <!-- Funkƒçn√≠: Stroje -->
        <a href="/machines" class="dashboard-tile" style="
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: var(--bg-secondary); border: 2px solid var(--accent-orange);
            border-radius: 12px; padding: 1.5rem; text-decoration: none;
            transition: all 0.2s; min-height: 120px; width: 180px;
        " onmouseover="this.style.background='var(--accent-orange)'; this.style.transform='translateY(-2px)';"
           onmouseout="this.style.background='var(--bg-secondary)'; this.style.transform='none';">
            <span style="font-size: 2.5rem; margin-bottom: 0.5rem;">üîß</span>
            <span style="color: var(--text-primary); font-weight: 600; font-size: 1rem;">Stroje</span>
            <span style="color: var(--text-muted); font-size: 0.75rem;">Spr√°va stroj≈Ø</span>
        </a>

        <!-- Nefunkƒçn√≠: Reporty -->
        <div class="dashboard-tile" style="
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: var(--bg-secondary); border: 2px solid var(--border-color);
            border-radius: 12px; padding: 1.5rem; min-height: 120px; width: 180px; opacity: 0.5;
        ">
            <span style="font-size: 2.5rem; margin-bottom: 0.5rem;">üìä</span>
            <span style="color: var(--text-secondary); font-weight: 600; font-size: 1rem;">Reporty</span>
            <span style="color: var(--text-muted); font-size: 0.7rem; font-style: italic;">P≈ôipravujeme</span>
        </div>

        <!-- Funkƒçn√≠: Admin (Admin only) -->
        {% if user.role == 'admin' %}
        <a href="/admin/material-norms" class="dashboard-tile" style="
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: var(--bg-secondary); border: 2px solid #9333ea;
            border-radius: 12px; padding: 1.5rem; text-decoration: none;
            transition: all 0.2s; min-height: 120px; width: 180px;
        " onmouseover="this.style.background='#9333ea'; this.style.transform='translateY(-2px)';"
           onmouseout="this.style.background='var(--bg-secondary)'; this.style.transform='none';">
            <span style="font-size: 2.5rem; margin-bottom: 0.5rem;">‚öôÔ∏è</span>
            <span style="color: var(--text-primary); font-weight: 600; font-size: 1rem;">Admin</span>
            <span style="color: var(--text-muted); font-size: 0.75rem;">Normy + nastaven√≠</span>
        </a>
        {% endif %}

    </div>

    <!-- Statistiky -->
    <div style="margin-top: 2rem;">
        <h2 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 1rem; color: var(--text-secondary); text-align: center;">Statistiky</h2>
        <div style="display: flex; gap: 1rem; flex-wrap: wrap; justify-content: center;">
            <div style="background: var(--bg-secondary); border-radius: 8px; padding: 1rem 1.5rem; min-width: 120px;">
                <div style="color: var(--text-muted); font-size: 0.75rem;">Celkem d√≠l≈Ø</div>
                <div style="font-size: 1.5rem; font-weight: 700; color: var(--text-primary);">{{ parts|length }}</div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function quickJump() {
    return {
        search: '',
        loading: false,

        async jumpToPart() {
            const query = this.search.trim();
            if (!query) return;

            this.loading = true;

            try {
                const response = await fetch(`/api/parts/search?search=${encodeURIComponent(query)}&limit=1`);
                if (!response.ok) throw new Error('API error');

                const data = await response.json();

                if (data.total === 0) {
                    window.showToast('D√≠l nenalezen', 'error');
                } else if (data.total === 1) {
                    window.location.href = `/parts/${data.parts[0].part_number}/edit`;
                } else {
                    // V√≠ce v√Ωsledk≈Ø - skoƒçit na prvn√≠
                    window.showToast(`Nalezeno ${data.total} d√≠l≈Ø, otev√≠r√°m prvn√≠`, 'info');
                    window.location.href = `/parts/${data.parts[0].part_number}/edit`;
                }
            } catch (error) {
                console.error('Search error:', error);
                window.showToast('Chyba p≈ôi hled√°n√≠', 'error');
            } finally {
                this.loading = false;
            }
        }
    }
}
</script>
{% endblock %}
