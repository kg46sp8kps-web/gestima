{# GESTIMA - Reusable Jinja2 Macros (ADR-015) #}

{# ============================================================================
   FORM INPUTS
   ============================================================================ #}

{% macro form_input_text(name, label, value='', required=false, readonly=false, maxlength=200, help_text='') %}
<div class="form-field">
    <label for="{{ name }}">
        {{ label }}
        {% if required %}<span style="color: var(--error);">*</span>{% endif %}
    </label>
    <input
        type="text"
        id="{{ name }}"
        name="{{ name }}"
        value="{{ value }}"
        {% if required %}required{% endif %}
        {% if readonly %}readonly{% endif %}
        {% if maxlength %}maxlength="{{ maxlength }}"{% endif %}
        class="form-input"
    >
    {% if help_text %}
    <small class="help-text">{{ help_text }}</small>
    {% endif %}
</div>
{% endmacro %}

{% macro form_input_number(name, label, value='', min=none, max=none, step='any', required=false, readonly=false, help_text='') %}
<div class="form-field">
    <label for="{{ name }}">
        {{ label }}
        {% if required %}<span style="color: var(--error);">*</span>{% endif %}
    </label>
    <input
        type="number"
        id="{{ name }}"
        name="{{ name }}"
        value="{{ value }}"
        {% if min is not none %}min="{{ min }}"{% endif %}
        {% if max is not none %}max="{{ max }}"{% endif %}
        step="{{ step }}"
        {% if required %}required{% endif %}
        {% if readonly %}readonly{% endif %}
        class="form-input"
    >
    {% if help_text %}
    <small class="help-text">{{ help_text }}</small>
    {% endif %}
</div>
{% endmacro %}

{% macro form_select(name, label, options, selected='', required=false, help_text='') %}
<div class="form-field">
    <label for="{{ name }}">
        {{ label }}
        {% if required %}<span style="color: var(--error);">*</span>{% endif %}
    </label>
    <select
        id="{{ name }}"
        name="{{ name }}"
        {% if required %}required{% endif %}
        class="form-select"
    >
        {% for value, text in options %}
        <option value="{{ value }}" {% if value == selected %}selected{% endif %}>
            {{ text }}
        </option>
        {% endfor %}
    </select>
    {% if help_text %}
    <small class="help-text">{{ help_text }}</small>
    {% endif %}
</div>
{% endmacro %}

{% macro form_checkbox(name, label, checked=false, help_text='') %}
<div class="form-field form-field-checkbox">
    <label>
        <input
            type="checkbox"
            id="{{ name }}"
            name="{{ name }}"
            {% if checked %}checked{% endif %}
            class="form-checkbox"
        >
        <span>{{ label }}</span>
    </label>
    {% if help_text %}
    <small class="help-text">{{ help_text }}</small>
    {% endif %}
</div>
{% endmacro %}

{% macro form_textarea(name, label, value='', rows=4, required=false, readonly=false, maxlength=1000, help_text='') %}
<div class="form-field">
    <label for="{{ name }}">
        {{ label }}
        {% if required %}<span style="color: var(--error);">*</span>{% endif %}
    </label>
    <textarea
        id="{{ name }}"
        name="{{ name }}"
        rows="{{ rows }}"
        {% if required %}required{% endif %}
        {% if readonly %}readonly{% endif %}
        {% if maxlength %}maxlength="{{ maxlength }}"{% endif %}
        class="form-textarea"
    >{{ value }}</textarea>
    {% if help_text %}
    <small class="help-text">{{ help_text }}</small>
    {% endif %}
</div>
{% endmacro %}

{# ============================================================================
   TABLE COMPONENTS
   ============================================================================ #}

{% macro table_header(columns) %}
<thead>
    <tr>
        {% for col in columns %}
        <th>{{ col }}</th>
        {% endfor %}
    </tr>
</thead>
{% endmacro %}

{% macro table_empty_state(message="Žádné záznamy") %}
<tr>
    <td colspan="100" style="text-align: center; padding: 2rem; color: var(--text-muted);">
        {{ message }}
    </td>
</tr>
{% endmacro %}

{# ============================================================================
   BUTTONS
   ============================================================================ #}

{% macro btn_primary(text, onclick='', type='button') %}
<button type="{{ type }}" onclick="{{ onclick }}" class="btn btn-primary">
    {{ text }}
</button>
{% endmacro %}

{% macro btn_secondary(text, onclick='', type='button') %}
<button type="{{ type }}" onclick="{{ onclick }}" class="btn btn-secondary">
    {{ text }}
</button>
{% endmacro %}

{% macro btn_danger(text, onclick='', type='button') %}
<button type="{{ type }}" onclick="{{ onclick }}" class="btn btn-danger">
    {{ text }}
</button>
{% endmacro %}

{# ============================================================================
   CARDS & SECTIONS
   ============================================================================ #}

{% macro card(title='', class='') %}
<div class="card {{ class }}">
    {% if title %}
    <div class="card-header">
        <h3>{{ title }}</h3>
    </div>
    {% endif %}
    <div class="card-body">
        {{ caller() }}
    </div>
</div>
{% endmacro %}

{% macro form_section(title) %}
<div class="form-section">
    <h3 class="form-section-title">{{ title }}</h3>
    <div class="form-section-content">
        {{ caller() }}
    </div>
</div>
{% endmacro %}

{# ============================================================================
   MODALS
   ============================================================================ #}

{% macro modal_delete_confirm(entity_name='záznam') %}
<div
    x-data="{ open: false }"
    x-show="open"
    @delete-modal.window="open = true"
    @keydown.escape.window="open = false"
    x-cloak
    style="
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.5); display: flex; align-items: center;
        justify-content: center; z-index: 1000;
    "
>
    <div
        @click.away="open = false"
        style="
            background: var(--bg-primary); border-radius: 8px; padding: 2rem;
            max-width: 400px; width: 90%;
        "
    >
        <h3 style="margin-bottom: 1rem;">Potvrdit smazání</h3>
        <p style="margin-bottom: 1.5rem; color: var(--text-secondary);">
            Opravdu chcete smazat {{ entity_name }}? Tato akce je nevratná.
        </p>
        <div style="display: flex; gap: 1rem; justify-content: flex-end;">
            <button @click="open = false" class="btn btn-secondary">
                Zrušit
            </button>
            <button @click="confirmDelete()" class="btn btn-danger">
                Smazat
            </button>
        </div>
    </div>
</div>
{% endmacro %}

{# ============================================================================
   PAGINATION
   ============================================================================ #}

{% macro pagination(total, skip, limit, base_url) %}
{% set pages = (total + limit - 1) // limit %}
{% if pages > 1 %}
<div class="pagination">
    {% if skip > 0 %}
    <a href="{{ base_url }}?skip={{ skip - limit }}&limit={{ limit }}" class="page-link">
        ← Předchozí
    </a>
    {% endif %}

    <span class="page-info">
        Stránka {{ (skip // limit) + 1 }} z {{ pages }}
    </span>

    {% if skip + limit < total %}
    <a href="{{ base_url }}?skip={{ skip + limit }}&limit={{ limit }}" class="page-link">
        Další →
    </a>
    {% endif %}
</div>
{% endif %}
{% endmacro %}

{# ============================================================================
   BADGES
   ============================================================================ #}

{% macro badge(text, type='default') %}
<span class="badge badge-{{ type }}">{{ text }}</span>
{% endmacro %}

{# ============================================================================
   LOADING & STATES
   ============================================================================ #}

{% macro spinner(size='medium') %}
<div class="spinner spinner-{{ size }}"></div>
{% endmacro %}

{% macro alert(message, type='info') %}
<div class="alert alert-{{ type }}">
    {{ message }}
</div>
{% endmacro %}
